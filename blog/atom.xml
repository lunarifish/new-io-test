<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://your-docusaurus-site.example.com/blog</id>
    <title>sb Blog</title>
    <updated>2023-02-02T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://your-docusaurus-site.example.com/blog"/>
    <subtitle>sb Blog</subtitle>
    <entry>
        <title type="html"><![CDATA[systemd 杂谈]]></title>
        <id>https://your-docusaurus-site.example.com/blog/test</id>
        <link href="https://your-docusaurus-site.example.com/blog/test"/>
        <updated>2023-02-02T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[- 程序要开机自启]]></summary>
        <content type="html"><![CDATA[<ul>
<li>
<p>程序要开机自启</p>
</li>
<li>
<p>在 linux 下使用串口、socketcan 时总是免不了要先打一大堆命令赋权、启动</p>
</li>
<li>
<p>有多个 usb 设备的情况下不好区分谁是谁，设备文件顺序还会变</p>
</li>
</ul>
<p>利用好当今大多数发行版都有的 systemd，它的子组件如 udev、systemd-networkd 等等就可以解决这些麻烦问题。
如果以后遇到类似的问题，那 systemd 大概率也是有办法解决的。不要小看 PID=1 的力量。:)))</p>
<!-- -->
<p>[图片]</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="systemd-networkd">systemd-networkd<a href="https://your-docusaurus-site.example.com/blog/test#systemd-networkd" class="hash-link" aria-label="Direct link to systemd-networkd" title="Direct link to systemd-networkd">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="socketcan-自动-bringup">socketcan 自动 bringup<a href="https://your-docusaurus-site.example.com/blog/test#socketcan-%E8%87%AA%E5%8A%A8-bringup" class="hash-link" aria-label="Direct link to socketcan 自动 bringup" title="Direct link to socketcan 自动 bringup">​</a></h3>
<p>详情：<a href="https://wiki.archlinuxcn.org/wiki/Systemd-networkd" target="_blank" rel="noopener noreferrer">https://wiki.archlinuxcn.org/wiki/Systemd-networkd</a></p>
<p>systemd-networkd 用来按规则自动配置 netdev，正巧 can 在 linux 下就是 netdev</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>systemd-networkd 虽然可以配置 netdev，但不要举一反三去用它配置以太网接口。目前大多数 linux 发行版都用另外一个叫 NetworkManager 的软件来管理网络，同时使用两个软件管理网络可能会引起一些奇怪问题。</p><p>为什么不用 NetworkManager 管理 CAN？因为它没有这个功能。</p><p>说到这里了，就点名另外一个软件，netplan，也不要用它。</p></div></div>
<p>输入 <code>systemctl status systemd-networkd</code> 查看 systemd-networkd 有没有启动：</p>
<p>[图片]</p>
<p>如果显示 inactive 则输入 <code>systemctl start systemd-networkd</code> 启动服务，再输入 <code>systemctl enable systemd-networkd</code> 让服务开机自启。</p>
<p>[图片]</p>
<p>在<code>/etc/systemd/network/</code>文件夹下建立规则 <code>80-can.network</code> 如下：</p>
<p>暂时无法在飞书文档外展示此内容</p>
<p>此时系统就会自动按规则配置所有 CAN 接口波特率为 1M，并且启动他们，不需要再手动 <code>ip link set</code> 了。</p>
<p>重启一次系统查看效果，如果不想重启，则重启一次 systemd-networkd 服务：<code>systemctl restart systemd-networkd</code></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="udev">udev<a href="https://your-docusaurus-site.example.com/blog/test#udev" class="hash-link" aria-label="Direct link to udev" title="Direct link to udev">​</a></h2>
<p>udev 可以捕获内核产生的设备添加/移除事件，按配置的规则根据端口号、PID、VID 等等信息自动识别并配置设备（赋权、创建符号链接等等）</p>
<p>详情：<a href="https://www.jinbuguo.com/systemd/udev.html" target="_blank" rel="noopener noreferrer">https://www.jinbuguo.com/systemd/udev.html</a></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="固定-usb-设备自动赋权">固定 USB 设备+自动赋权<a href="https://your-docusaurus-site.example.com/blog/test#%E5%9B%BA%E5%AE%9A-usb-%E8%AE%BE%E5%A4%87%E8%87%AA%E5%8A%A8%E8%B5%8B%E6%9D%83" class="hash-link" aria-label="Direct link to 固定 USB 设备+自动赋权" title="Direct link to 固定 USB 设备+自动赋权">​</a></h3>
<p>USB 设备都有 VID 和 PID 两个识别符，输入 lsusb 列出目前插入的所有 usb 设备：</p>
<p>[图片]</p>
<p>以 <code>Bus 001 Device 003: ID 8087:0029 Intel Corp. AX200 Bluetooth</code> 为例：</p>
<ul>
<li>
<p>busnum=1</p>
</li>
<li>
<p>devicenum=3</p>
</li>
<li>
<p>vid=8087</p>
</li>
<li>
<p>pid=0029</p>
</li>
</ul>
<p>一般来说只根据 vid 和 pid 就可以确定一个唯一的 usb 设备，但如果有两个完全一样的 usb 设备，就还需要额外根据 busnum 和 devicenum 来确定一个唯一的设备。</p>
<p>假设现在有一个 usb 转串口的 CH340 模块吧：</p>
<p>[图片]</p>
<p>[图片]</p>
<p>每次使用它之前，都要输入 <code>sudo chmod 666 /dev/ttyUSB0</code> 来赋权，而且如果有多个一样的模块，就要指定赋权插在某个 USB 端口上的，PID 为多少，VID 为多少的设备，仅仅通过/dev 下的文件名肯定
是区分不开的。</p>
<p>在<code>/etc/udev/rules.d/</code>文件夹下建立规则 <code>100-usbserial.rules</code> 如下：</p>
<p>暂时无法在飞书文档外展示此内容</p>
<p>刷新 udev：</p>
<p>暂时无法在飞书文档外展示此内容</p>
<p>此时在/dev 里可以看到一个叫 my_usb_serial 的文件，它就是经过 udev 配置之后的，之前看到的 ttyUSB0。之后每次插入符合规则的 usb 设备时，这个文件都会立即出现。</p>
<p>[图片]</p>
<p>同理也可以利用 udev 固定 USB 转 CAN 模块，像下面这样，就可以在 busnum=3, devnum=7 的 usb 转 can 模块插入之后创建一个叫 my_usb_can 的网络接口：</p>
<p>暂时无法在飞书文档外展示此内容</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="systemdservice">systemd.service<a href="https://your-docusaurus-site.example.com/blog/test#systemdservice" class="hash-link" aria-label="Direct link to systemd.service" title="Direct link to systemd.service">​</a></h2>
<p>详情：<a href="https://www.jinbuguo.com/systemd/systemd.service.html" target="_blank" rel="noopener noreferrer">https://www.jinbuguo.com/systemd/systemd.service.html</a></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="开机自启">开机自启<a href="https://your-docusaurus-site.example.com/blog/test#%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF" class="hash-link" aria-label="Direct link to 开机自启" title="Direct link to 开机自启">​</a></h3>
<p>把要开机自启的动作编写成一个 service，注册给 systemd 即可实现可控、稳定的开机自启以及 fail retry。</p>
<p>比如要让一个 ROS 节点自启，并且崩溃之后可以自己尝试再自启的话，就先写这样一个启动脚本：</p>
<p>暂时无法在飞书文档外展示此内容</p>
<p>然后，编写服务文件 <code>control_node.service</code></p>
<ul>
<li>
<p><code>After=network.target</code>：在系统启动阶段达到 network 目标之后启动这个服务</p>
</li>
<li>
<p><code>ExecStart=/home/a/ws/launch.sh</code>：设置 entry 为启动脚本<code>/home/a/ws/launch.sh</code></p>
</li>
<li>
<p><code>Restart=always</code>：自动重启</p>
</li>
</ul>
<p>暂时无法在飞书文档外展示此内容</p>
<p>把这个 control_node.service 复制到<code>/usr/lib/systemd/system</code> 目录下，然后执行 <code>systemd daemon-reload</code> 重启 systemd daemon。</p>
<p>此时执行 <code>systemctl status control_node</code> 就可以看到注册的服务了：</p>
<p>[图片]</p>
<p>执行 <code>systemctl start control_node</code> 即可启动服务，执行 <code>systemctl enable control_node</code> 即可让服务开机自启。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="不启动桌面环境">不启动桌面环境<a href="https://your-docusaurus-site.example.com/blog/test#%E4%B8%8D%E5%90%AF%E5%8A%A8%E6%A1%8C%E9%9D%A2%E7%8E%AF%E5%A2%83" class="hash-link" aria-label="Direct link to 不启动桌面环境" title="Direct link to 不启动桌面环境">​</a></h3>
<p>为了节省性能，或者是为了加快开机速度等等，可以修改 systemd 的默认启动 target 为 <code>multi-user.target</code>，只启动到终端环境里：</p>
<p>暂时无法在飞书文档外展示此内容</p>
<p>如果要恢复桌面环境，把默认 target 改回 <code>graphical.target</code> 即可：</p>
<p>暂时无法在飞书文档外展示此内容</p>]]></content>
        <category label="linux" term="linux"/>
        <category label="systemd" term="systemd"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Welcome]]></title>
        <id>https://your-docusaurus-site.example.com/blog/welcome</id>
        <link href="https://your-docusaurus-site.example.com/blog/welcome"/>
        <updated>2021-08-26T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Docusaurus blogging features are powered by the blog plugin.]]></summary>
        <content type="html"><![CDATA[<p><a href="https://docusaurus.io/docs/blog" target="_blank" rel="noopener noreferrer">Docusaurus blogging features</a> are powered by the <a href="https://docusaurus.io/docs/api/plugins/@docusaurus/plugin-content-blog" target="_blank" rel="noopener noreferrer">blog plugin</a>.</p>
<p>Here are a few tips you might find useful.</p>
<p>Simply add Markdown files (or folders) to the <code>blog</code> directory.</p>
<p>Regular blog authors can be added to <code>authors.yml</code>.</p>
<p>The blog post date can be extracted from filenames, such as:</p>
<ul>
<li><code>2019-05-30-welcome.md</code></li>
<li><code>2019-05-30-welcome/index.md</code></li>
</ul>
<p>A blog post folder can be convenient to co-locate blog post images:</p>
<p><img decoding="async" loading="lazy" alt="Docusaurus Plushie" src="https://your-docusaurus-site.example.com/assets/images/docusaurus-plushie-banner-a60f7593abca1e3eef26a9afa244e4fb.jpeg" width="1500" height="500" class="img_ev3q"></p>
<p>The blog supports tags as well!</p>
<p><strong>And if you don't want a blog</strong>: just delete this directory, and use <code>blog: false</code> in your Docusaurus config.</p>]]></content>
        <author>
            <name>Sébastien Lorber</name>
            <uri>https://sebastienlorber.com</uri>
        </author>
        <category label="Facebook" term="Facebook"/>
        <category label="Hello" term="Hello"/>
        <category label="Docusaurus" term="Docusaurus"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[MDX Blog Post]]></title>
        <id>https://your-docusaurus-site.example.com/blog/mdx-blog-post</id>
        <link href="https://your-docusaurus-site.example.com/blog/mdx-blog-post"/>
        <updated>2021-08-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Blog posts support Docusaurus Markdown features, such as MDX.]]></summary>
        <content type="html"><![CDATA[<p>Blog posts support <a href="https://docusaurus.io/docs/markdown-features" target="_blank" rel="noopener noreferrer">Docusaurus Markdown features</a>, such as <a href="https://mdxjs.com/" target="_blank" rel="noopener noreferrer">MDX</a>.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Use the power of React to create interactive blog posts.</p></div></div>
<!-- -->
<p>For example, use JSX to create an interactive button:</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">button onClick</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:hsl(221, 87%, 60%)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">alert</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'button clicked!'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token maybe-class-name">Click</span><span class="token plain"> me</span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain">button</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<button>Click me!</button>]]></content>
        <author>
            <name>Sébastien Lorber</name>
            <uri>https://sebastienlorber.com</uri>
        </author>
        <category label="Docusaurus" term="Docusaurus"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Long Blog Post]]></title>
        <id>https://your-docusaurus-site.example.com/blog/long-blog-post</id>
        <link href="https://your-docusaurus-site.example.com/blog/long-blog-post"/>
        <updated>2019-05-29T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[This is the summary of a very long blog post,]]></summary>
        <content type="html"><![CDATA[<p>This is the summary of a very long blog post,</p>
<p>Use a <code>&lt;!--</code> <code>truncate</code> <code>--&gt;</code> comment to limit blog post size in the list view.</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>]]></content>
        <author>
            <name>Sébastien Lorber</name>
            <uri>https://sebastienlorber.com</uri>
        </author>
        <category label="Hello" term="Hello"/>
        <category label="Docusaurus" term="Docusaurus"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[First Blog Post]]></title>
        <id>https://your-docusaurus-site.example.com/blog/first-blog-post</id>
        <link href="https://your-docusaurus-site.example.com/blog/first-blog-post"/>
        <updated>2019-05-28T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Lorem ipsum dolor sit amet...]]></summary>
        <content type="html"><![CDATA[<p>Lorem ipsum dolor sit amet...</p>
<p>...consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>]]></content>
        <author>
            <name>Sébastien Lorber</name>
            <uri>https://sebastienlorber.com</uri>
        </author>
        <category label="Hola" term="Hola"/>
    </entry>
</feed>